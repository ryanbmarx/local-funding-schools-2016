{#
 # Template for an HTML story published to P2P.
 #
 # If you want to publish multiple HTML stories, copy, or inherit from
 # this template.
 # 
 #}
{% block content %}
<div class='graphic-wrapper'>
	{{ intro|markdown }}
	<div class="story-link">
		{{ story_link|markdown }}
	</div>
	<figure class='scatter' >
		<figcaption>
			<p class='scatter__label'>{{ chart_label }}</p>	
				<dl class='scatter__legend'>
					<dt>
						<span class='trib-legend__circle'></span>
					</dt>
					<dd>One school district</dd>
				</dl>
		</figcaption>
		<div class='scatter__container' data-highlight='all'></div>
	</figure>
	{%- for chart in charts -%}
	<figure class='scatter scatter--small' >
		<figcaption>
			<p class='scatter__label'>{{ chart.chart_label }}</p>	
			{% if chart.blurb %}
				{{ chart.blurb|markdown }}
			{% endif %}
		</figcaption>
		<div class='row'>
			<div class='three columns'>
				<p class='map-label'>Median household income</p>
				<div class='map-legend'>
					<p class='map-legend__label map-legend__label--lower'>Lower</p>
					<p class='map-legend__label map-legend__label--higher'>Higher</p>
					{# <div class='map-legend__bar'></div> #}
				</div>
				<img class='scatter__map' src='http://{{ ROOT_URL }}/img/{{ chart.county_group }}.png' alt="Map of Illinois' {{ chart.county_group }} counties"  />
			</div>
			<div class='nine columns'>
				<div class='scatter__container' data-highlight='{{ chart.county_group }}'></div>
			</div>
		</div>
	<p class="notes">Counties:&nbsp;
	{%- for county in county_groups if county.group == chart.county_group -%}
		{{ county.county }}{% if not loop.last %}, {% endif %}
		{%- endfor -%}
	</p>
	</figure>
	{%- endfor -%}
	

	{% include "_lookup-table.html" %}

	<div class='credits'>
		{{ notes|markdown }}
		{{ sources|markdown }}
		{{ credits|markdown }}
	</div>

</div>
{% endblock content %}

{% block library_scripts %}
{# Uncomment this if you are using libraries such as jQuery #}
<script src="//{{ ROOT_URL }}/js/vendor.min.js"></script>
{% endblock %}

{% block scripts %}
{# Uncomment this if you are using custom JavaScript #}
<script src="//{{ ROOT_URL }}/js/app.min.js"></script>
<script>
(function(document) {
	// var $ = require('jquery');
	// var dt = require( 'datatables.net' )( window, $ );
	// var dr = require( 'datatables.net-responsive' )( window, $ );

	window.ROOT_URL = "{{ ROOT_URL }}";
	window.x_label = "{{ x_label }}";
	window.x_series = "{{ x_series }}";
	window.y_label = "{{ y_label }}";
	window.y_series = "{{ y_series }}";
	window.countyGroups = {
		{%- for county_group in ["north", 'chicagoArea', 'central', "south"] -%}
			{{ county_group }}:[
				{%- for county in county_groups if county.group == county_group -%}
				"{{ county.county|lower }}" {% if not loop.last%},{% endif %}
				{%- endfor -%}
				]{% if not loop.last%},{% endif %}
		{%- endfor -%}
	};

	console.log(countyGroups);
  var CSS = [
	"//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css",
	"//cdn.datatables.net/responsive/2.1.0/css/responsive.dataTables.min.css",
    "//{{ ROOT_URL }}/css/styles.css"
  ];
  CSS.forEach(function(url) {
    var link = document.createElement('link');
    link.setAttribute('rel', 'stylesheet');
    link.setAttribute('href', url);
    document.head.appendChild(link);
  });


	// var districtsLookup = $('#districts-lookup').DataTable({
	// 	"paging": true,
	// 	"searching": true,
	// 	"ordering": true,
	// 	"order": [[ 5, "asc" ]],
	// 	// "bAutoWidth":false,
	// 	"responsive": {
	// 		details:{
	// 			type: 'column',
	// 			target: 'tr'
	// 		}, 
	// 		breakpoints: [
	// 			{ name: 'desktop', width: Infinity },
	// 			{ name: 'tablet',  width: 840 },
	// 			{ name: 'phone',   width: 420 }
	// 		],
	// 		"columnDefs": [ 
	// 			{ "orderable": false, "targets": 0 }
	// 		]
	// 	}
	// });
	// function getParameterByName(name, url) {
	//     if (!url) {
	//       url = window.location.href;
	//     }
	//     name = name.replace(/[\[\]]/g, "\\$&");
	//     var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
	//         results = regex.exec(url);
	//     if (!results) return null;
	//     if (!results[2]) return '';
	//     return decodeURIComponent(results[2].replace(/\+/g, " "));
	// }
	// window.onload = function(){
	// 	let searchValue = getParameterByName('search');
	// 	console.log(searchValue);
	// 	districtsLookup.search(searchValue).draw();
	// }
})(document);
</script>
{% endblock scripts %}
